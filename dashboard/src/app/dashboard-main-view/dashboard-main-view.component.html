<div class="dashboard-main-container">
  <div class="frosted-glass-container">
    <div class="dashboard-header">
      <h1>Dashboard InstaSwiss</h1>
      <div class="subtitle subtitle-flex">
        API-Schlüssel gespeichert
        <button
          class="remove-api-key-btn"
          mat-stroked-button
          color="warn"
          (click)="removeApiKey.emit()"
        >
          Entfernen
        </button>
      </div>
    </div>
    <div class="dashboard-content">
      <div class="stats-header">
        <div class="stats-title">Anzahl veröffentlichter Wanderungen heute</div>
        <div class="total-hike-count">{{ hikes.length }}</div>
        <div class="total-hike-count-small">Inklusive Unveröffentlichte: {{ totalHikeCount }}</div>
      </div>
      <app-subscription-stats [hikes]="hikes"></app-subscription-stats>
      <div class="dashboard-card">
        <div class="card-title">
          Alle Wanderungen
          <button 
            class="toggle-hikes-btn"
            mat-stroked-button
            (click)="toggleHikeList()"
          >
            {{ showAllHikes ? 'Weniger anzeigen' : 'Alle anzeigen' }}
          </button>
        </div>
        <div class="hike-list-scroll-wrapper">
          <table class="hike-list-table">
            <thead>
              <tr>
                <th>Wanderung</th>
                <th>Creator</th>
                <th>Erstellt</th>
              </tr>
            </thead>
            <tbody>
              @for (hike of displayedHikes; track hike.id) {
                <tr>
                  <td>{{ hike.name_de }}</td>
                  <td>
                    {{ hike.creator.first_name || '' }}
                    {{ hike.creator.last_name || hike.creator.email || '' }}
                  </td>
                  <td>{{ hike.date_created | date: 'dd.MM.yyyy' }}</td>
                </tr>
              }
              @if (!showAllHikes && sortedHikes.length > maxVisibleHikes) {
                <tr class="more-hikes-row">
                  <td colspan="3" class="more-hikes-message">
                    ... und {{ sortedHikes.length - maxVisibleHikes }} weitere Wanderungen
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
      <div class="dashboard-card">
        <div class="card-title">Todos</div>
        @if (!showWorkView) {
          <app-todo-list
            (workViewRequested)="onWorkViewRequested()"
            @flyInOut
          ></app-todo-list>
        } @else {
          <div class="frosted-glass-container test-results-container">
            <div class="test-results-header">
              <button
                class="back-btn"
                (click)="onWorkViewBack()"
                aria-label="Zurück"
              >
                <svg
                  width="28"
                  height="28"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
              </button>
              <h2 class="centered">Todos bearbeiten</h2>
            </div>
            <div class="test-results-list-wrapper">
              <app-todo-work @flyInOut></app-todo-work>
            </div>
          </div>
        }
      </div>
    </div>
    <button class="run-tests-btn" (click)="runTests.emit()">
      Tests ausführen
    </button>
  </div>
</div>
